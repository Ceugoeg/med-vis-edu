# v1.5 更新汇总（组员A）

## 版本定位
`v1.5` 是当前 A 感知层的稳定版本，重点完成了：
- 动态阈值（尤其 PINCH）
- 自适应滤波（动态 alpha）
- 多层稳态控制（滞回 + 投票 + 状态保持）
- 四模块交互语义对齐（FIST/OPEN/PINCH/NONE）

保持约束：
- 不改主流程 `app.js` 逻辑
- 只通过 `window.handData` 对接
- 状态协议仍为四态：`OPEN | FIST | PINCH | NONE`

---

## 当前输出协议（未变）
```js
window.handData = {
  state: 'OPEN' | 'FIST' | 'PINCH' | 'NONE',
  landmarks: [{ x, y, z }, ...21个],
  confidence: 0.0 ~ 1.0
};
```

---

## v1.5 关键能力

### 1) PINCH：动态比例阈值 + 张开基线门控
- 判定从绝对距离升级为相对手尺度：
  - `pinchRatio = dist(4,8) / dist(0,5)`
- 增加 `pinchOpenBaselineCount`，要求在“张开基线”上触发捏合，降低误触。

### 2) FIST：y 轴贴近判据强化
- 新增四指 `tip/mcp` 的 y 轴贴近计数（`fistYCount`），更贴合“握拳聚合”语义。
- 与卷曲距离判据叠加，提升“握拳却判 NONE”的问题。

### 3) OPEN：y 轴展开 + 展开距离双判据
- OPEN 不再只看单一距离，而是双条件通过，减少抖动和误开。

### 4) 稳态链路：滞回 + 投票 + 状态保持
- 滞回：进入/退出阈值分离（OPEN/FIST）
- 投票：滑动窗口众数输出（`stateVoteWindow`）
- 状态保持：`stateHoldFrames`

### 5) 自适应滤波（动态 alpha）
- 慢速动作：更平稳
- 快速动作：更灵敏
- 在稳定性和响应速度之间取得平衡

---

## v1.5 默认参数（当前）
```txt
adaptiveSmoothing: true
minAdaptiveAlpha: 0.16
maxAdaptiveAlpha: 0.50
velocityLow: 0.003
velocityHigh: 0.03

dynamicPinch: true
pinchRatioThreshold: 0.34
pinchOpenBaselineCount: 2

openEnterExtensionThreshold: 0.035
openExitExtensionThreshold: 0.02
openEnterYGapThreshold: -0.065
openExitYGapThreshold: -0.045

fistEnterCurlThreshold: -0.01
fistExitCurlThreshold: -0.004
fistEnterYGapAbsThreshold: 0.065
fistExitYGapAbsThreshold: 0.08
thumbCurledEnterThreshold: 0.065
thumbCurledExitThreshold: 0.075

stateVoteWindow: 5
openConfirmFramesAfterAction: 2
stateHoldFrames: 1
flipY: false
```

---

## 当前交互语义（A 层输出）
- `FIST`: 聚合意图，提供稳定“握拳态”供 C 层触发收拢与整体旋转。
- `OPEN`: 散开意图，提供稳定“张开态”供 C 层触发散开与后续约束。
- `PINCH`: 聚焦意图，在张开基线上进行精准捏合。
- `NONE`: 中性缓冲态，用于动作切换与防抖。

---

## 已知边界
- C 层状态机映射（如“OPEN 后严格锁旋转”、“FIST+Delta 旋转”）属于引擎层实现，不在 A 层内直接修改。
- A 层已完成识别与稳定输出，后续主要是实机参数微调。
